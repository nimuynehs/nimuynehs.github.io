LCD_RS BIT P2.4;choosing data/order 
LCD_RW BIT P2.5;choosing r/w
LCD_EN BIT P2.6;energy enable
LCD_DATA EQU P0;data interface
ALL_FLAG EQU 20H;signal bit
LCD_FLAG EQU ALL_FLAG.7;busy signal
LCD_DAT  EQU 30H;data order word
TLOW EQU 0CH;INITIAL VALUE OF TIMER
THIGH EQU 0DCH
MIN EQU 31H
SEC EQU 32H
SEC0 EQU 33H
KEY_D EQU 34H
KEY_S EQU 35H
X EQU 36H
KEY_C EQU 37H
KEY0 EQU P3.0
KEY1 EQU P3.1
KEY2 EQU P3.2
KEY3 EQU P3.3

ORG  0000H
MAIN:
ACALL DELAY1
MOV A,#00H
MOV  P2,00H
MOV P1,0FFH
JNB KEY0,K0
JNB KEY1,K1
JNB	KEY2,K2
JNB KEY3,K3
SJMP MAIN

K0:
ACALL DELAY
SETB P1.4
CPL P1.4
LJMP K010
K1:
ACALL DELAY
SETB P1.5
CPL P1.5
LJMP K110
K2:
ACALL DELAY
SETB P1.6
CPL P1.6
LJMP K210
K3:
ACALL DELAY
SETB P1.7
CPL P1.7
LJMP K310
	 
JUMP:
LJMP MAIN
DELAY:
MOV  R6,#01H
DL1:
MOV R7,#088H
DL2:
DJNZ R7,DL2
DJNZ R6,DL1
RET

DELAY1:
MOV  R6,#015H
DL21:
MOV R7,#0F8H
DL22:
DJNZ R7,DL22
DJNZ R6,DL21
RET

K010:MOV R0,#01H
MOV R1,#00H
K01:MOV R2,#08H	 
DLV11:MOV R3,#070H
DLV21:CPL P1.0
LCALL DELAY2
DJNZ R3,DLV21
DJNZ R2,DLV11
MOV R2,#10H
DLV31:MOV R3,#0A0H
DLV41:CPL P1.0
LCALL DELAY3
DJNZ R3,DLV41
DJNZ R2,DLV31
CALL LCD
MOV A,#30H
ADD A,R1
CALL LCD_WDATA
MOV A,#30H
ADD A,R0
CALL LCD_WDATA
INC R0
CLR C
SUBB A,#'9'
JZ INC_R10
AJMP K01
INC_R10:
INC R1
MOV R0,#00H
AJMP K01
DELAY2:MOV R7,#0FFH
 JB P3.0,JUMP
LLA1:DJNZ R7,LLA1
RET
DELAY3:MOV R7,#060H
 JB P3.0,JUMP
LLB1:DJNZ R7,LLB1
RET

K110:MOV R0,#01H
	MOV R1,#00H

K11:MOV R2,#08H	 
DLV12:MOV R3,#70H
DLV22:CPL P1.0
LCALL DELAY4
DJNZ R3,DLV22
DJNZ R2,DLV12
MOV R2,#10H
DLV32:MOV R3,#70H
DLV42:CPL P1.0
LCALL DELAY5
DJNZ R3,DLV42
DJNZ R2,DLV32
CALL LCD
MOV A,#30H
ADD A,R1
CALL LCD_WDATA
MOV A,#30H
ADD A,R0
CALL LCD_WDATA
INC R0
CLR C
SUBB A,#'9'
JZ INC_R11
AJMP K11
INC_R11:
INC R1
MOV R0,#00H
AJMP K11
DELAY4:MOV R7,#0FFH
 JB P3.1,JUMP1
 SJMP LLA1
DELAY5:MOV R7,#080H
 JB P3.1,JUMP1
 SJMP LLB1

JUMP1:
CALL DELAY5MS
LJMP MAIN



K210:MOV R0,#01H
MOV R1,#00H

K21:MOV R2,#08H	 
DLV13:MOV R3,#90H
DLV23:CPL P1.0
LCALL DELAY6
DJNZ R3,DLV23
DJNZ R2,DLV13
MOV R2,#10H
DLV33:MOV R3,#70H
DLV43:CPL P1.0
LCALL DELAY7
DJNZ R3,DLV43
DJNZ R2,DLV33
CALL LCD
MOV A,#30H
ADD A,R1
CALL LCD_WDATA
MOV A,#30H
ADD A,R0
CALL LCD_WDATA
INC R0
CLR C
SUBB A,#'9'
JZ INC_R12
AJMP K21
INC_R12:
INC R1
MOV R0,#00H
AJMP K21
DELAY6:MOV R7,#0A0H
 JB P3.2,JUMP1
 LJMP LLA1
DELAY7:MOV R7,#080H
 JB P3.2,JUMP1
 LJMP LLB1	

K310:MOV R0,#01H 
	MOV R1,#00H

K31:MOV R2,#08H	 
DLV14:MOV R3,#20H
DLV24:CPL P1.0
LCALL DELAY8
DJNZ R3,DLV24
DJNZ R2,DLV14
MOV R2,#10H
DLV34:MOV R3,#0B0H
DLV44:CPL P1.0
LCALL DELAY9
DJNZ R3,DLV44
DJNZ R2,DLV34
CALL LCD
MOV A,#30H
ADD A,R1
CALL LCD_WDATA
MOV A,#30H
ADD A,R0
CALL LCD_WDATA
INC R0
CLR C
SUBB A,#'9'
JZ INC_R13
AJMP K31
INC_R13:
INC R1
MOV R0,#00H
AJMP K31
DELAY8:MOV R7,#00H
 JB P3.3,JUMP2
 LJMP LLA1
DELAY9:MOV R7,#128
 JB P3.3,JUMP2
 LJMP LLB1
JUMP2:
LJMP MAIN
LCD:
CALL LCD_INIT
MOV A,#80H
CALL LCD_WCMD
MOV A,#'L'
CALL LCD_WDATA
MOV A,#'A'
CALL LCD_WDATA
MOV A,#'S'
CALL LCD_WDATA
MOV A,#'T'
CALL LCD_WDATA
MOV A,#'I'
CALL LCD_WDATA
MOV A,#'N'
CALL LCD_WDATA
MOV A,#'G'
CALL LCD_WDATA
MOV A,#':'
CALL LCD_WDATA
CALL DELAY5MS
RET
DELAY5MS:
MOV R6,#10
DLL1:
DJNZ R7,$
DJNZ R6,DLL1
RET
LCD_INIT:
CALL DELAY5MS
MOV A,#38H
CALL LCD_WCMD
CALL DELAY5MS
CALL DELAY5MS
MOV A,#06H
CALL LCD_WCMD
MOV A,#01H
CALL LCD_WCMD
MOV A,#0CH
CALL LCD_WCMD
RET
LCD_WCMD:
CALL CHECKBUSY
CLR LCD_RS
JMP W_LCD
LCD_WDATA:
CALL CHECKBUSY
SETB LCD_RS
W_LCD:
CLR LCD_RW
MOV LCD_DATA,A
SETB LCD_EN
NOP
CLR LCD_EN
RET
CHECKBUSY:
PUSH ACC
MOV LCD_DATA,#0FFH
CLR LCD_RS
SETB LCD_RW
BUSYLOOP:
SETB LCD_EN
NOP
MOV A,LCD_DATA
CLR LCD_EN
JB ACC.7,BUSYLOOP
POP ACC
RET

END
